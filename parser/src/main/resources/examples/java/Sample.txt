package io.slalom.steviemul.samples;

import java.sql.Connection;
import java.sql.Statement;
import java.sql.DriverManager;
import java.sql.*;
import java.util.List;
import java.util.ArrayList;
import java.security.MessageDigest;

@SampleAnnotation
public final class Sample extends Sample1 implements Sample2, Sample3 {

  static {
    int i = 10;
  }

  private static final String DB_USERNAME = "username";
  private static final String DB_PASSWORD = "password";

  static {
    String username = "username";
    DB_USERNAME = username;
  }

  private MessageDigest md = MessageDigest.getInstance("MD5");

  private String name;

  private int x = 5, y = 10;

  private List<String> addressLines = new ArrayList<>();
  private InnerSample innerSample = new InnerSample();

  public String getName() {
    return name;
  }

  public Sample(String name) {
    this.name = name;
  }

  public List<String> getLines() {
    return addressLines.stream()
      .filter(e -> e.contains("test"))
      .collect(Collectors.toList());
  }

  private String execute(String query) {
    Connection con = DriverManager.getConnection(
      "jdbc:mysql://db.com:3306/core",
      DB_USERNAME,
      DB_PASSWORD);

    Statement stmt = con.createStatement();

    return stmt.execute(query);
  }

  public String getDetails() {
    String query = "SELECT age FROM USERS WHERE name='" + name + "'";

    return execute(query);
  }

  @SampleAnnotation(uri = "/app/users/{name}")
  public void execute(String name) {
    String query = "SELECT age FROM USERS WHERE name='" + name + "'";

    return execute(query);
  }

  public static void main(String[] args) {
    Sample sample = new Sample(args[0]);

    String details = sample.getDetails();

    if (details.length > 10) {
      System.out.println("Details are big");
    }
    else {
      System.out.println("Details are normal");
    }

    System.out.println(details);
  }

  public static void output(String args[]) {
    Sample sample = new Sample(args[0]);

    System.out.println(sample);
  }

  class InnerSample {
    private String name;

    String getName() {
      return this.name;
    }

    void setName(String name) {
      this.name = name;
    }
  }
}